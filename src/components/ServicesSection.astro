---
// src/components/ServicesSection.astro
import { cosmic } from '../lib/cosmic';
import type { Service } from '../types';
import { ArrowRight } from 'lucide-astro';

let services: Service[] = [];

try {
  const response = await cosmic.objects
    .find({ type: 'services' })
    .props(['id', 'title', 'slug', 'metadata'])
    .depth(1);
  services = response.objects as Service[];
} catch (error) {
  console.error('Error fetching services:', error);
}
---

<section id="services" class="py-20 bg-white">
  <div class="container mx-auto px-6">
    <!-- Section Header -->
    <div class="text-center mb-16">
      <h2 class="text-3xl lg:text-4xl font-bold text-gray-900 mb-4">
        Our Services
      </h2>
      <p class="text-lg text-gray-600 max-w-2xl mx-auto">
        We offer comprehensive digital solutions to help your business thrive in the modern marketplace.
      </p>
    </div>
    
    <!-- Services Grid -->
    <div class="grid md:grid-cols-2 lg:grid-cols-3 gap-8">
      {services.map((service) => (
        <div class="group bg-white rounded-xl shadow-lg hover:shadow-xl transition-all duration-300 overflow-hidden border border-gray-100 hover:border-primary-200">
          <!-- Service Icon -->
          {service.metadata.service_icon && (
            <div class="h-48 overflow-hidden">
              <img 
                src={`${service.metadata.service_icon.imgix_url}?w=400&h=200&fit=crop&auto=format,compress`}
                alt={service.metadata.service_name || service.title}
                width="400"
                height="200"
                class="w-full h-full object-cover group-hover:scale-105 transition-transform duration-300"
              />
            </div>
          )}
          
          <div class="p-6">
            <!-- Service Name -->
            <h3 class="text-xl font-bold text-gray-900 mb-3">
              {service.metadata.service_name || service.title}
            </h3>
            
            <!-- Short Description -->
            <p class="text-gray-600 mb-4 line-clamp-3">
              {service.metadata.short_description}
            </p>
            
            <!-- Key Features -->
            {service.metadata.key_features && (
              <div class="mb-4">
                <ul class="space-y-1">
                  {service.metadata.key_features.split('\n').slice(0, 3).map((feature: string) => (
                    <li class="text-sm text-gray-500 flex items-center gap-2">
                      <div class="w-1.5 h-1.5 bg-primary-500 rounded-full"></div>
                      {feature.trim()}
                    </li>
                  ))}
                </ul>
              </div>
            )}
            
            <!-- Starting Price -->
            {service.metadata.starting_price && (
              <div class="flex items-center justify-between mt-6">
                <span class="text-2xl font-bold text-primary-600">
                  {service.metadata.starting_price}
                </span>
                <button class="text-primary-600 hover:text-primary-700 font-medium flex items-center gap-1 transition-colors">
                  Learn More
                  <ArrowRight size={16} />
                </button>
              </div>
            )}
          </div>
        </div>
      ))}
    </div>
  </div>
</section>